# C4 model

**Формирование маршрутной сети движения поездов**

**Легенда:**

Федеральная пассажирская компания (ФПК) — основной оператор пассажирских перевозок РЖД — разрабатывает перспективную маршрутную сеть на трёхлетний период, включая планирование "ниток" (базовых маршрутов поездов с расписанием и техническими параметрами) и формирование групп вагонов. При этом группы вагонов могут создаваться как самой ФПК, так и сторонними перевозчиками, после чего компания комбинирует их в схемы поездов — конкретные конфигурации составов. Один поезд может иметь несколько схем с разной периодичностью, что позволяет гибко адаптироваться к сезонным изменениям спроса.

---

Приведена часть диаграмм, чтобы дать представление о формате описания, не перегружая пример деталями.

## System Context

![System Context](./img/System_Context.drawio.svg)

<details>
    <summary>Описание взаимодействия элементов на уровне системного контекста</summary>
    <table>
        <tr>
            <th>№</th>
            <th colspan="2">Участники</th>
            <th>Описание</th>
        </tr>
        <tr>
            <td>1</td>
            <td>Администратор</td>
            <td rowspan="6">АСУ МС</td>
            <td rowspan="6">Полный перечень полномочий ролей представлен в разделе Ролевая модель</td>
        </tr>
        <tr>
            <td>2</td>
            <td>Работник</td>
        </tr>
        <tr>
            <td>3</td>
            <td>Руководитель аппарата управления</td>
        </tr>
        <tr>
            <td>4</td>
            <td>Руководитель филиала</td>
        </tr>
        <tr>
            <td>5</td>
            <td>Специалист аппарата управления</td>
        </tr>
        <tr>
            <td>6</td>
            <td>Специалист филиала</td>
        </tr>
        <tr>
            <td>7</td>
            <td>АСУ МС</td>
            <td>Active Directory</td>
            <td>Аутентификация пользователя. <br>
                Получение сведений учетной записи пользователя.
            </td>
        </tr>
        <tr>
            <td>8</td>
            <td>АСУ МС</td>
            <td>ЦСУ</td>
            <td>Получает справочники:<br>
                <ul>
                    <li> Железные дороги;
                    <li> Станции;
                    <li> Перевозчики;
                    <li> Классы обслуживания.
                </ul>
                Получает сведения контроля параметров перевозок:<br>
                <ul>
                    <li> Сведения контроля наличия свободных мест;
                    <li> Сведения контроля схем;
                    <li> Фактические показатели перевозок;
                    <li> Сведения о вагонах находящихся в аренде и ЗКУ.
                </ul>
            </td>
        </tr>
        <tr>
            <td>9</td>
            <td>АСУ МС</td>
            <td>Microsoft Exchange</td>
            <td>Использует для отправки e-mail пользователю</td>
        </tr>
        <tr>
            <td>10</td>
            <td>ЦСУ</td>
            <td>АСУ МС</td>
            <td>Получает утвержденную маршрутную сеть</td>
        </tr>
        <tr>
            <td>11</td>
            <td>Microsoft Exchange</td>
            <td>Сотрудник ФПК</td>
            <td>Отправляет e-mail на почтовый ящик пользователя</td>
        </tr>
    </table>
</details>

### Containers (АСУ МС)

![Containers (АСУ МС)](./img/Containers_1.drawio.svg)

<details>
    <summary>Описание взаимодействия элементов на уровне групп контейнеров АСУ МС</summary>
    <table>
        <tr>
            <th>№</th>
            <th colspan="2">Участники</th>
            <th>Протокол/Технология</th>
            <th>Описание</th>
        </tr>
        <tr>
            <td>1</td>
            <td>Веб-интерфейс</td>
            <td>API Gateway</td>
            <td>HTTPS/GraphQL</td>
            <td>Документация доступна по <a href="https://api.empty/doc">ссылке</a></td>
        </tr>
        <tr>
            <td>2</td>
            <td>Веб-интерфейс</td>
            <td>Сервисы управления файлами</td>
            <td>HTTPS/REST</td>
            <td>Загрузка/выгрузка файлов</td>
        </tr>
        <tr>
            <td>3</td>
            <td>API Gateway</td>
            <td>Инфраструктурные сервисы</td>
            <td>HTTPS/GraphQL, WSS/GraphQL</td>
            <td>Запуск синхронизации сведений по свободным местам инициируемый администратором системы; <br>
                Просмотр и очистка списка уведомлений; <br>
                Выполнение запросов на подписку на уведомления</td>
        </tr>
        <tr>
            <td>4</td>
            <td>API Gateway</td>
            <td>Сервисы управления файлами</td>
            <td>HTTPS/GraphQL</td>
            <td>Получение сведений о файлах:<br>
                <ul>
                    <li> по конкретному файлу;
                    <li> список файлов в очереди;
                    <li> список файлов в бакете;
                </ul>
                Удаление файлов:<br>
                    <ul>
                        <li> c диска;
                        <li> из очереди;
                    </ul>
            </td>
        </tr>
        <tr>
            <td>5</td>
            <td>API Gateway</td>
            <td>Классификаторы</td>
            <td>HTTPS/GraphQL</td>
            <td>Просмотр справочников:<br>
                <ul>
                    <li> отдельных записей;
                    <li> истории изменений записи;
                    <li> списка записей;
                </ul>
                Создание записей;<br>
                Редактирование записей
            </td>
        </tr>
        <tr>
            <td>6</td>
            <td>API Gateway</td>
            <td>Сервисы планирования поездов</td>
            <td>HTTPS/GraphQL</td>
            <td>Управление сведениями по поездам, расписаниям, схемам, группам вагонов и вагонам (создание, просмотр, редактирование, удаление, согласование, отклонение, утверждение и т.д.)
            </td>
        </tr>
        <tr>
            <td>7</td>
            <td>API Gateway</td>
            <td>Сервисы формирования отчётов</td>
            <td>HTTPS/GraphQL</td>
            <td>Формирование отчетов и выгрузка отчётов в файл</td>
        </tr>
        <tr>
            <td>8</td>
            <td>API Gateway</td>
            <td>Сервисы администрирования</td>
            <td>HTTPS/GraphQL</td>
            <td>Просмотр журнала действий пользователя;<br>
            Управление настройками пользователя и фича-флагами;<br>
            Управление новостями, вопросами и инструкциями;<br>
            Управление полномочиями пользователей;<br>
            Управление сведениями о пользователях;<br>
            Вход, выход в/из системы и обновление токена доступа;<br>
            </td>
        </tr>
        <tr>
            <td>9</td>
            <td>API Gateway</td>
            <td>Сервисы администрирования</td>
            <td>AMQP</td>
            <td>Проверяет наличие прав доступа</td>
        </tr>
        <tr>
            <td>10</td>
            <td>ЦСУ</td>
            <td>API Gateway</td>
            <td>HTTPS/GraphQL</td>
            <td>Получает утвержденную маршрутную сеть (Список поездов в статусе "Утвержден" включая их расписания, схемы, группы вагонов и вагоны)</td>
        </tr>
        <tr>
            <td>11</td>
            <td>Инфраструктурные сервисы</td>
            <td>ЦСУ</td>
            <td>HTTPS/REST</td>
            <td>Получает справочники:<br>
                <ul>
                    <li> Железные дороги;
                    <li> Станции;
                    <li> Перевозчики;
                    <li> Классы обслуживания.
                </ul>
                Получает сведения контроля параметров перевозок:<br>
                <ul>
                    <li> Сведения контроля наличия свободных мест;
                    <li> Сведения контроля схем;
                    <li> Фактические показатели перевозок;
                    <li> Сведения о вагонах находящихся в аренде и ЗКУ.
                </ul>
            </td>
        </tr>
            <tr>
            <td>12</td>
            <td>Инфраструктурные сервисы</td>
            <td>Microsoft Exchange</td>
            <td>SMTP</td>
            <td>Использует для отправки e-mail</td>
        </tr>
        <tr>
            <td>13</td>
            <td>Инфраструктурные сервисы</td>
            <td>API Gateway</td>
            <td>WSS/GraphQL</td>
            <td>Отправляет уведомления о событиях в системе</td>
        </tr>
        <tr>
            <td>14</td>
            <td>Инфраструктурные сервисы</td>
            <td>Оркестратор</td>
            <td>AMQP</td>
            <td>Запускает саги:<br>
                <ul>
                    <li> Синхронизации данных
                </ul>
            </td>
        </tr>
        <tr>
            <td>15</td>
            <td>Инфраструктурные сервисы</td>
            <td>Классификаторы</td>
            <td>AMQP</td>
            <td>Отправляет сведения справочников:<br>
                <ul>
                    <li> Железные дороги
                    <li> Железнодорожные администрации
                    <li> Перевозчики
                    <li> Классы обслуживания
                </ul>
            </td>
        </tr>
        <tr>
            <td>16</td>
            <td>Сервисы управления файлами</td>
            <td>Инфраструктурные сервисы</td>
            <td>AMQP</td>
            <td>Использует для отправки уведомлений</td>
        </tr>
        <tr>
            <td>17</td>
            <td>Сервисы управления файлами</td>
            <td>Оркестратор</td>
            <td>AMQP</td>
            <td>Запускает саги:<br>
                <ul>
                    <li> Экспорт показателей поездов
                    <li> Экспорт требуемого парка
                    <li> Экспорт расчета МВПС
                    <li> Экспорт контроля схем
                    <li> Экспорт контроля схем по филиалам
                    <li> Экспорт свободных мест
                    <li> Экспорт показателей расчета инфраструктуры
                    <li> Экспорт расчета итоговых показателей поездов
                    <li> Экспорт итоговых показателей групп вагонов
                </ul>
            </td>
        </tr>
        <tr>
            <td>18</td>
            <td>Сервисы управления файлами</td>
            <td>Сервисы планирования поездов</td>
            <td>AMQP</td>
            <td>Получает:<br>
                <ul>
                    <li> Поезда
                    <li> Группы вагонов
                </ul>
            </td>
        </tr>
        <tr>
            <td>19</td>
            <td>Сервисы управления файлами</td>
            <td>Классификаторы</td>
            <td>AMQP</td>
            <td>Получает классификаторы:<br>
                <ul>
                    <li> Мнемоники
                    <li> Станции
                </ul>
            </td>
        </tr>
        <tr>
            <td>20</td>
            <td>Классификаторы</td>
            <td>Оркестратор</td>
            <td>AMQP</td>
            <td>Запускает саги :<br>
            <ul>
                <li> Создание
                <li> Редактирование
            </ul>
            </td>
        </tr>
        <tr>
            <td>21</td>
            <td>Сервисы планирования поездов</td>
            <td>Классификаторы</td>
            <td>AMQP</td>
            <td>Получает классификаторы:
                <ul>
                    <li> Категории поездов
                    <li> Филиалы
                    <li> Железнодорожные администрации
                    <li> Перевозчики
                    <li> Станции
                    <li> Типы вагонов
                    <li> Виды секций
                    <li> и пр.
                <ul>
            </td>
        </tr>
        <tr>
            <td>22</td>
            <td>Сервисы планирования поездов</td>
            <td>Оркестратор</td>
            <td>AMQP</td>
            <td>Запускает саги:<br>
                <ul>
                    <li> Создание поезда
                    <li> Редактирование поезда
                    <li> Удаление поезда
                    <li> Копирование расписания
                    <li> Экспорт списка поездов в файл
                    <li> Изменение статуса поезда
                    <li> Согласование поезда подразделением
                    <li> Отклонение поезда подразделением
                    <li> Создание расписания
                    <li> Редактирование расписания
                    <li> Удаление расписания
                    <li> Выгрузка расписания в файл
                    <li> Выгрузка расписания в файл
                    <li> Создание группы
                    <li> Редактирование группы
                    <li> и пр.
                </ul>
            </td>
        </tr>
        <tr>
            <td>23</td>
            <td>Сервисы формирования отчётов</td>
            <td>Сервисы планирования поездов</td>
            <td>AMQP</td>
            <td>Получает:<br>
                <ul>
                    <li> Поезда
                    <li> Группы вагонов
                </ul>
            </td>
        </tr>
        <tr>
            <td>24</td>
            <td>Сервисы формирования отчётов</td>
            <td>Классификаторы</td>
            <td>AMQP</td>
            <td>Получает классификаторы:<br>
                <ul>
                    <li> Станции
                    <li> Ставка за управление и эксплуатацию, тех. обслуживание и ремонт МВПС
                    <li> Перевозчики
                    <li> Типы вагонов
                    <li> Все справочники инфраструктуры
                    <li> Максимальная скорость
                </ul>
            </td>
        </tr>
        <tr>
            <td>25</td>
            <td>Сервисы формирования отчётов</td>
            <td>Оркестратор</td>
            <td>AMQP</td>
            <td>Запускает саги:<br>
                <ul>
                    <li> Обновление типов вагонов по датам
                    <li> Обновление прогноза
                    <li> Выгрузка требуемого парка
                    <li> Выгрузка расчета МВПС
                    <li> Расчет МВПС
                    <li> Экспорт показателей групп вагонов итогового расчета
                    <li> Расчет инфраструктуры
                    <li> Экспорт показателей поездов итогового расчета
                    <li> и пр.
                </ul>
            </td>
        </tr>
        <tr>
            <td>26</td>
            <td>Сервисы администрирования</td>
            <td>Классификаторы</td>
            <td>AMQP</td>
            <td>Получает классификаторы:<br>
                <ul>
                    <li> Филиалы
                </ul>
            </td>
        </tr>
        <tr>
            <td>27</td>
            <td>Сервисы администрирования</td>
            <td>Оркестратор</td>
            <td>AMQP</td>
            <td>Запускает саги:<br>
                <ul>
                    <li> Создание пользователя
                    <li> Удаление пользователя
                    <li> Редактирование пользователя
                    <li> Отправка сообщения пользователю
                    <li> Отправка отправка уведомления и e-mail
                </ul>
            </td>
        </tr>
        <tr>
            <td>28</td>
            <td>Сервисы администрирования</td>
            <td>Active Directory</td>
            <td>LDAP</td>
            <td>Получает сведения о пользователе</td>
        </tr>
        <tr>
            <td>29</td>
            <td>Оркестратор</td>
            <td>Инфраструктурные сервисы</td>
            <td>AMQP</td>
            <td>Использует для отправки уведомлений</td>
        </tr>
        <tr>
            <td>30</td>
            <td>Оркестратор</td>
            <td>Сервисы управления файлами</td>
            <td>AMQP</td>
            <td>Вызывает операции с файлами<br>
                <ul>
                    <li> Добавление экспорта файла в очередь
                    <li> Экспорт показателей групп вагонов итогового расчета
                    <li> Экспорт показателей поездов
                    <li> Экспорт показателей поездов итогового расчета
                    <li> Экспорт показателей инфраструктуры
                    <li> Экспорт расчета МВПС
                    <li> Экспорт требуемого парка
                    <li> Регистрация файла
                    <li> Парсинг файла расписания
                </ul>
            </td>
        </tr>
        <tr>
            <td>31</td>
            <td>Оркестратор</td>
            <td>Классификаторы</td>
            <td>AMQP</td>
            <td>Получает классификаторы:<br>
                <ul>
                    <li> Станции
                </ul>
            </td>
        </tr>
        <tr>
            <td>32</td>
            <td>Оркестратор</td>
            <td>Сервисы планирования поездов</td>
            <td>AMQP</td>
            <td>Вызывает операции с поездами, расписаниями, схемами, группами вагонов</td>
        </tr>
        <tr>
            <td>33</td>
            <td>Оркестратор</td>
            <td>Сервисы формирования отчетов</td>
            <td>AMQP</td>
            <td>Вызывает операции по показателям:<br>
                <ul>
                    <li> Актуализация материализованного представления
                    <li> Копирование показателей групп вагонов
                    <li> Обновление показателей групп вагонов
                    <li> Удаление показателей групп вагонов
                    <li> Экспорт данных показателей групп вагонов итогового расчета
                    <li> Экспорт итогового расчета по поездам
                    <li> Экспорт данных итогового расчета по поездам
                    <li> Экспорт показателей расчета инфраструктуры
                    <li> Экспорт расчета МВПС
                    <li> Экспорт требуемого парка
                    <li> Редактирование среднего состава по датам
                    <li> Редактирование прогноза среднего состава
                    <li> Создание поезда
                    <li> Создание версии поезда
                    <li> Удаление поезда
                    <li> Редактирование поезда
                </ul>
            </td>
        </tr>
        <tr>
            <td>34</td>
            <td>Оркестратор</td>
            <td>Сервисы администрирования</td>
            <td>AMQP</td>
            <td>Вызывает операции:<br>
                <ul>
                    <li> Регистрация пользовательской операции
                    <li> Получение ролей пользователей
                    <li> Обновление кэша
                    <li> Получение e-mail пользователя
                    <li> Создание пользователя
                    <li> Редактирование пользователя
                    <li> Удаление пользователя
                </ul>
            </td>
        </tr>
    </table>
</details>


#### Containers (Сервисы администрирования)

![Containers (Сервисы администрирования)](./img/Containers_2.1.drawio.svg)

<details>
    <summary>Описание взаимодействия элементов на уровне контейнеров группы сервисов администрирования</summary>
    <table>
        <tr>
            <th>№</th>
            <th colspan="2">Участники</th>
            <th>Протокол/Технология</th>
            <th>Описание</th>
        </tr>
        <tr>
            <td>1</td>
            <td>API Gateway</td>
            <td>Сервис журналирования</td>
            <td>HTTPS/GraphQL</td>
            <td>Вызывает операции:<br>
                <ul>
                    <li> Получение журнала действий конкретного пользователя
                    <li> Получение журнала действий всех пользователей
                    <li> Экспорт журнала в файл
                    <li> Получение журнала действий текущего пользователя
                </ul>
            </td>
        </tr>
        <tr>
            <td>2</td>
            <td>API Gateway</td>
            <td>Сервис конфигурации</td>
            <td>HTTPS/GraphQL</td>
            <td>Вызывает операции:<br>
                <ul>
                    <li> Фича-флаги:
                    <ul> 
                        <li> Получение списка
                        <li> Редактирование
                    </ul>
                    <li> Фича-флаги пользователя:
                    <ul>
                        <li> Получение списка
                        <li> Добавление
                        <li> Редактирование
                        <li> Удаление
                    </ul>
                    <li> Настройки пользователя:
                    <ul>
                        <li> Получение
                        <li> Обновление
                    </ul>
                </ul>
            </td>
        </tr>
        <tr>
            <td>3</td>
            <td>API Gateway</td>
            <td>Сервис новостей</td>
            <td>HTTPS/GraphQL</td>
            <td>Вызывает операции:<br>
                <ul>
                    <li> Новости:
                    <ul> 
                        <li> Получение списка
                        <li> Создание
                        <li> Редактирование
                        <li> Удаление
                    </ul>
                    <li> Вопросы/ответы:
                    <ul>
                        <li> Получение списка
                        <li> Создание
                        <li> Редактирование
                        <li> Удаление
                    </ul>
                    <li> Инструкции:
                    <ul>
                        <li> Получение списка
                        <li> Создание
                        <li> Редактирование
                        <li> Удаление
                    </ul>
                </ul>
            </td>
        </tr>
        <tr>
            <td>4</td>
            <td>API Gateway</td>
            <td>Управление доступом</td>
            <td>HTTPS/GraphQL</td>
            <td>Вызывает операции:<br>
                <ul>
                    <li> Роли:
                    <ul> 
                        <li> Получение списка
                        <li> Получение конкретной роли
                        <li> Редактирование
                        <li> Обновление кэша
                    </ul>
                    <li> Полномочия:
                    <ul>
                        <li> Получение списка
                        <li> Создание
                        <li> Редактирование
                    </ul>
                    <li> Модули:
                    <ul>
                        <li> Получение списка
                    </ul>
                    <li> Подразделения ФПК:
                    <ul>
                        <li> Получение списка
                        <li> Создание
                        <li> Редактирование
                    </ul>
                </ul>
            </td>
        </tr>
        <tr>
            <td>5</td>
            <td>API Gateway</td>
            <td>Управление доступом</td>
            <td>AMQP</td>
            <td>Проверяет наличие прав доступа</td>
        </tr>
        <tr>
            <td>6</td>
            <td>API Gateway</td>
            <td>Пользователи</td>
            <td>HTTPS/GraphQL</td>
            <td>Вызывает операции:<br>
                <ul>
                    <li> Пользователи:
                        <ul>
                            <li> Получение списка
                            <li> Получение конкретного пользователя
                            <li> Получение текущего пользователя
                            <li> Создание
                            <li> Редактирование
                            <li> Удаление
                        </ul>
                    <li> Сессии:
                        <ul>
                            <li> Получение списка
                            <li> Получение сессии текущего пользователя
                            <li> Завершение сессии текущего пользователя
                            <li> Завершение сессии конкретного пользователя
                        </ul>
                </ul>
            </td>
        </tr>
        <tr>
            <td>7</td>
            <td>API Gateway</td>
            <td>Сервис идентификации</td>
            <td>HTTPS/GraphQL</td>
            <td>Вызывает операции:<br>
                <ul>
                    <li> Вход в систему
                    <li> Выход из системы
                    <li> Обновление токена доступа
                </ul>
            </td>
        </tr>
        <tr>
            <td>8</td>
            <td>Сервис журналирования</td>
            <td>БД asu_ms_journal</td>
            <td>TCP/JDBC</td>
            <td>Чтение/Запись данных из/в БД</td>
        </tr>
        <tr>
            <td>9</td>
            <td>Сервис конфигурирования</td>
            <td>БД asu_ms_configuration</td>
            <td>TCP/JDBC</td>
            <td>Чтение/Запись данных из/в БД</td>
        </tr>
        <tr>
            <td>10</td>
            <td>Сервис новостей</td>
            <td>БД asu_ms_cms</td>
            <td>TCP/JDBC</td>
            <td>Чтение/Запись данных из/в БД</td>
        </tr>
        <tr>
            <td>11</td>
            <td>Сервис новостей</td>
            <td>Оркестратор</td>
            <td>AMQP</td>
            <td>Запускает саги:<br>
                <ul>
                    <li> Отправка уведомления и e-mail
                </ul>
            </td>
        </tr>
        <tr>
            <td>12</td>
            <td>Управление доступом</td>
            <td>БД asu_ms_rbac</td>
            <td>TCP/JDBC</td>
            <td>Чтение/Запись данных из/в БД</td>
        </tr>
        <tr>
            <td>13</td>
            <td>Управление доступом</td>
            <td>Пользователи</td>
            <td>AMQP</td>
            <td>Получает индивидуальные полномочия пользователя</td>
        </tr>
        <tr>
            <td>14</td>
            <td>Пользователи</td>
            <td>БД asu_ms_users</td>
            <td>TCP/JDBC</td>
            <td>Чтение/Запись данных из/в БД</td>
        </tr>
        <tr>
            <td>15</td>
            <td>Пользователи</td>
            <td>Оркестратор</td>
            <td>AMQP</td>
            <td>Запускает саги:<br>
                <ul>
                    <li> Создание пользователя
                    <li> Редактирование пользователя
                    <li> Удаление пользователя
                </ul>
            </td>
        </tr>
        <tr>
            <td>16</td>
            <td>Сервис идентификации</td>
            <td>Active Directory</td>
            <td>LDAP</td>
            <td>Получает сведения о пользователе:<br>
                <ul>
                    <li> ФИО
                    <li> контакты
                    <li> группы
                    <li> и пр.
                </ul>
            </td>
        </tr>
        <tr>
            <td>17</td>
            <td>Сервис идентификации</td>
            <td>Классификаторы</td>
            <td>AMQP</td>
            <td>Получает филиалы ФПК</td>
        </tr>
        <tr>
            <td>18</td>
            <td>Сервис идентификации</td>
            <td>Управление доступом</td>
            <td>AMQP</td>
            <td>Получает роли пользователей</td>
        </tr>
        <tr>
            <td>19</td>
            <td>Сервис идентификации</td>
            <td>Пользователи</td>
            <td>AMQP</td>
            <td>Вызывает операции:<br>
                <ul>
                    <li> Получение пользователя
                    <li> Создание пользователя
                </ul>
            </td>
        </tr>
        <tr>
            <td>20</td>
            <td>Оркестратор</td>
            <td>Сервис журналирования</td>
            <td>AMQP</td>
            <td>Вызывает операцию регистрации действия пользователя</td>
        </tr>
        <tr>
            <td>21</td>
            <td>Оркестратор</td>
            <td>Управление доступом</td>
            <td>AMQP</td>
            <td>Вызывает операцию обновления кэша полномочий</td>
        </tr>
        <tr>
            <td>22</td>
            <td>Оркестратор</td>
            <td>Пользователи</td>
            <td>AMQP</td>
            <td>Вызывает операции:<br>
                <ul>
                    <li> Получение e-mail пользователя
                    <li> Создание пользователя
                    <li> Редактирование пользователя
                    <li> Удаление пользователя
                </ul>
            </td>
        </tr>
    </table>
</details>

##### Components (Сервис идентификации)

![Components (Сервис идентификации)](./img/Components_2.1.1.drawio.svg)

<details>
    <summary>Описание взаимодействия элементов на уровне компонентов сервиса идентификации</summary>
    <table>
        <tr>
            <th>№</th>
            <th colspan="2">Участники</th>
            <th>Протокол/Технология</th>
            <th>Описание</th>
        </tr>
        <tr>
            <td>1</td>
            <td>API Gateway</td>
            <td>API GQL Controller</td>
            <td>HTTP/GraphQL</td>
            <td>Вызывает операции:<br>
                <ul>
                    <li> Вход в систему
                    <li> Выход из системы
                    <li> Обновление токена доступа
                </ul>
            </td>
        </tr>
        <tr>
            <td>2</td>
            <td>API GQL Controller</td>
            <td>Модуль<br> authentication.service</td>
            <td>Function Call</td>
            <td>Вызывает операции:<br>
                <ul>
                    <li> preSingIn() - проверка валидности токена
                    <li> signIn() - вход в систему
                    <li> signOut() - выход из системы
                    <li> refrashToken() - обновление токена доступа
                </ul>
            </td>
        </tr>
        <tr>
            <td>3</td>
            <td>Модуль<br> authentication.service</td>
            <td>Модуль<br> ldap.service</td>
            <td>Function Call</td>
            <td>Вызывает операции:<br>
                <ul>
                    <li> searchInLDAP() - поиск пользователя в службе каталогов ФПК
                    <li> parseUserCn() - парсинг (определение роли и филиала пользователя)
                </ul>
            </td>
        </tr>
        <tr>
            <td>4</td>
            <td>Модуль<br> authentication.service</td>
            <td>Producer очереди users</td>
            <td>Function Call</td>
            <td>Вызывает операции:<br>
                <ul>
                    <li> getUser() - получение пользователя
                    <li> create() - создание пользователя
                </ul>
            </td>
        </tr>
        <tr>
            <td>5</td>
            <td>Модуль<br> authentication.service</td>
            <td>Session service</td>
            <td>TCP/RESP</td>
            <td>Вызывает операции:<br>
                <ul>
                    <li> newSession() - создание сессии
                    <li> getRecord() - получение сессии
                    <li> setRecord() - обновление сессии
                    <li> rmSession() - удаление сессии
                </ul>
            </td>
        </tr>
        <tr>
            <td>6</td>
            <td>Модуль<br> ldap.service</td>
            <td>Active Directory</td>
            <td>LDAP</td>
            <td>Вызывает операции:<br>
                <ul>
                    <li> bind() - подключение
                    <li> search() - поиск пользователя
                    <li> unbind() - отключение
                </ul>
            </td>
        </tr>
        <tr>
            <td>7</td>
            <td>Модуль<br> ldap.service</td>
            <td>Producer очереди classifiers</td>
            <td>Function Call</td>
            <td>Вызывает операции:<br>
                <ul>
                    <li> branch.byName() - получение филиала по наименованию
                </ul>
            </td>
        </tr>
        <tr>
            <td>8</td>
            <td>Модуль<br> ldap.service</td>
            <td>Producer очереди rbac</td>
            <td>Function Call</td>
            <td>Вызывает операции:<br>
                <ul>
                    <li> getRoleByCnLDAP() - получение роли пользователя по постфиксу группы AD
                    <li> getDefaultRole() - получение ролей по умолчанию
                </ul>
            </td>
        </tr>
        <tr>
            <td>9</td>
            <td>Producer очереди users</td>
            <td>Пользователи</td>
            <td>AMQP</td>
            <td>Отправляет сообщения:<br>
                <ul>
                    <li> users.getUser - Запрос на получение пользователя
                    <li> users.create - Запрос на создание пользователя
                </ul>
            </td>
        </tr>
        <tr>
            <td>10</td>
            <td>Producer очереди classifiers</td>
            <td>Классификаторы</td>
            <td>AMQP</td>
            <td>Отправляет сообщения:<br>
                <ul>
                    <li> branch.byName - Запрос на получение филиала по его наименованию
                </ul>
            </td>
        </tr>
        <tr>
            <td>11</td>
            <td>Producer очереди rbac</td>
            <td>Управление доступом</td>
            <td>AMQP</td>
            <td>Отправляет сообщения:<br>
                <ul>
                    <li> rbac.getRoleByCnLDAP - Запрос на получение роли пользователя по постфиксу группы AD
                </ul>
            </td>
        </tr>
    </table>
</details>

##### Components (Сервис Пользователи)

![Components (Сервис идентификации)](./img/Components_2.1.2.drawio.svg)

<details>
    <summary>Описание взаимодействия элементов на уровне компонентов сервиса пользователи</summary>
    <table>
        <tr>
            <th>№</th>
            <th colspan="2">Участники</th>
            <th>Протокол/Технология</th>
            <th>Описание</th>
        </tr>
        <tr>
            <td>1</td>
            <td>API Gateway</td>
            <td>API GQL Controller</td>
            <td>HTTPS/GraphQL</td>
            <td>Вызывает операции:<br>
                <ul>
                    <li> Пользователи:
                        <ul>
                            <li> list() - получить список
                            <li> by_id() - получить конкретного пользователя
                            <li> me() - получить текущего пользователя
                            <li> create() - создать
                            <li> update() - редактировать
                            <li> delete() - удалить
                        </ul>
                    <li> Сессии:
                        <ul>
                            <li> session_list() - получить сессию конкретного пользователя
                            <li> terminate_session_user() - завершить сессию пользователя
                            <li> me_session() - получить сессию текущего пользователя
                            <li> terminate_session_for_me() - завершить сессию текущего пользователя
                        </ul>
                </ul>
            </td>
        </tr>
        <tr>
            <td>2</td>
            <td>API GQL Controller</td>
            <td>Модуль<br>users.service</td>
            <td>Function Call</td>
            <td>Вызывает операции:<br>
                <ul>
                    <li> Пользователи:
                        <ul>
                            <li> list() - получить список
                            <li> byId() - получить пользователя
                            <li> create() - создать нового пользователя
                            <li> update() - редактировать
                            <li> delete() - удалить
                        </ul>
                    <li> Сессии:
                        <ul>
                            <li> getSessionInformation() - получение сессии
                            <li> logoutUserFromSession() - завершение сессии
                        </ul>
                </ul>
            </td>
        </tr>
        <tr>
            <td>3</td>
            <td>Модуль<br>users.service</td>
            <td>Session service</td>
            <td>TCP/RESP</td>
            <td>Вызывает операции:<br>
                <ul>
                    <li> getRecord() - получение сессии
                    <li> rmSession() - удаление сессии
                </ul>
            </td>
        </tr>
        <tr>
            <td>4</td>
            <td>Модуль<br>users.service</td>
            <td>БД asu_ms_users</td>
            <td>TCP/JDBC</td>
            <td>Чтение/Запись данных из/в БД</td>
        </tr>
        <tr>
            <td>5</td>
            <td>Модуль<br>users.service</td>
            <td>Producer очереди asu_ms_service_orchestration</td>
            <td>Function Call</td>
            <td>Запускает саги:<br>
                <ul>
                    <li> CREATE_USER - создание пользователя
                    <li> UPDATE_USER - редактирование пользователя
                    <li> DELETE_USER - удаление пользователя
                    <li> SEND_USER_MESSAGE - отправка сообщения
                </ul>
            </td>
        </tr>
        <tr>
            <td>6</td>
            <td>Producer очереди asu_ms_service_orchestration</td>
            <td>Оркестратор</td>
            <td>AMQP</td>
            <td>Отправляет сообщения:<br>
                <ul>
                    <li> orchestration.saga.run - Запрос на запуск саги
                </ul>
            </td>
        </tr>
        <tr>
            <td>7</td>
            <td>Сервис идентификации</td>
            <td>RMQ Controller очереди users</td>
            <td>AMQP</td>
            <td>Отправляет сообщения:<br>
                <ul>
                    <li> users.getUser - Запрос на получение пользователя
                    <li> users.create - Запрос на создание пользователя
                </ul>
            </td>
        </tr>
        <tr>
            <td>8</td>
            <td>Управление доступом</td>
            <td>RMQ Controller очереди users</td>
            <td>AMQP</td>
            <td>Отправляет сообщения:<br>
                <ul>
                    <li> users.getUserRules - Запрос на получение индивидуальных полномочий пользователя
                </ul>
            </td>
        </tr>
        <tr>
            <td>9</td>
            <td>Оркестратор</td>
            <td>RMQ Controller очереди users</td>
            <td>AMQP</td>
            <td>Отправляет сообщения:<br>
                <ul>
                    <li> users.getUsersEmailsWithIds - Запрос на получение e-mail
                    <li> users.create - Запрос на создание пользователя
                    <li> users.update - Запрос на редактирование пользователя
                    <li> users.delete - Запрос на удаление пользователя
                </ul>
            </td>
        </tr>
        <tr>
            <td>10</td>
            <td>RMQ Controller очереди users</td>
            <td>Модуль<br> user.rmq.service</td>
            <td>Function Call</td>
            <td>Вызывает операции:<br>
                <ul>
                    <li> getUser() - получить пользователя
                    <li> createUser() - создать пользователя
                    <li> updateUser() - редактировать пользователя
                    <li> deleteUser() - удалить пользователя
                    <li> getUsersEmailsWithIds() - получить e-mail пользователя
                    <li> getUserRules() - получить индивидуальные полномочия пользователя
                </ul>
            </td>
        </tr>
        <tr>
            <td>11</td>
            <td>Модуль<br> user.rmq.service</td>
            <td>Модуль<br> user.service</td>
            <td>Function Call</td>
            <td>Вызывает операции:<br>
                <ul>
                    <li> list() - получить список пользователей
                </ul>
            </td>
        </tr>
        <tr>
            <td>12</td>
            <td>Модуль<br> user.rmq.service</td>
            <td>БД asu_ms_users</td>
            <td>TCP/JDBC</td>
            <td>Запись данных в БД</td>
        </tr>
        <tr>
            <td>13</td>
            <td>Модуль<br> user.rmq.service</td>
            <td>Модуль<br> user.rules.service</td>
            <td>Function Call</td>
            <td>Вызывает операции:<br>
                <ul>
                    <li> getRuleIdsByUserIds() - получить идентификаторы полномочий 
                    <li> createAndDelete() - формирование(изменение) списка индивидуальных полномочий
                </ul>
            </td>
        </tr>
        <tr>
            <td>14</td>
            <td>Модуль<br> user.rmq.service</td>
            <td>Модуль<br> user.roles.service</td>
            <td>Function Call</td>
            <td>Вызывает операции:<br>
                <ul>
                    <li> getRoleIdsByUserIds() - получить идентификаторы ролей 
                    <li> updateUserRoles() - редактировать список ролей пользователя
                </ul>
            </td>
        </tr>
        <tr>
            <td>15</td>
            <td>Модуль<br> user.rules.service</td>
            <td>БД asu_ms_users</td>
            <td>TCP/JDBC</td>
            <td>Чтение/Запись данных из/в БД</td>
        </tr>
        <tr>
            <td>16</td>
            <td>Модуль<br> user.roles.service</td>
            <td>БД asu_ms_users</td>
            <td>TCP/JDBC</td>
            <td>Чтение/Запись данных из/в БД</td>
        </tr>
    </table>
</details>
