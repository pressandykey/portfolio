# Проектирование базы данных

**Легенда:**

Федеральная пассажирская компания (ФПК) — основной оператор пассажирских перевозок РЖД — разрабатывает перспективную маршрутную сеть на трёхлетний период, включая планирование "ниток" (базовых маршрутов поездов с расписанием и техническими параметрами) и формирование групп вагонов. При этом группы вагонов могут создаваться как самой ФПК, так и сторонними перевозчиками, после чего компания комбинирует их в схемы поездов — конкретные конфигурации составов. Один поезд может иметь несколько схем с разной периодичностью, что позволяет гибко адаптироваться к сезонным изменениям спроса.

## Концептуальная модель

### Диаграмма

![CDM](./img/CMD.drawio.svg)

### Сущности

| Сущность           | Описание                                                                                                                                                                                                                                                                     |
| ------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **ГДП**            | График движения поездов - план организации перевозок. Характеризуется периодом, на который запланированы маршруты курсирования поездов.                                                                                                                                                                |
| **Вагон**          | Подвижная единица. Входит в состав поезда и имеет некоторое количество мест для посадки пассажиров.                                                                                                                                                                          |
| **Группа вагонов** | Сцеп нескольких вагонов. Объединение вагонов, определяющееся общими для всех вагонов входящих в группу станциями отправления и назначения, станциями прицепки и отцепки к/от поезда и периодом курсирования. Является логической единицей управления перевозочным процессом. |
| **Дорога**         | Железная дорога. Структурная часть сети железных дорог. Характеризуется своим собственным аппаратом управления. Регулирует перевозки в рамках своей инфраструктуры.                                                                                                          |
| **Тип места**      | Типы мест имеющиеся в вагоне с указанием их количества и класса обслуживания                                                                                                                                                                                                 |
| **Перевозчик**     | Организация, занимающаяся планированием и организацией курсирования поездов                                                                                                                                                                                                  |
| **Поезд**          | Сцеп подвижных единиц, состоящий из вагонов, локомотивов или вагонов МВПС, осуществляющих перевозку пассажиров по заданному маршруту с некоторой периодичностью.                                                                                                             |
| **Станция**        | Объект железнодорожной инфраструктуры, на котором осуществляются операции с поездом, такие как посадка/высадка пассажиров, прицепка/отцепка групп вагонов, смена локомотива или смена локомотивной бригады.                                                                  |
| **Схема**          | Объединение групп вагонов в установленном порядке следования, курсирующих в составе поезда. Характеризуется собственной периодичностью, которая может отличаться от поезда. Поезд в разные дни может курсировать с разными схемами.                                          |

### Связи

| Сущность       | Кратность | Связь               | Сущность       | Кратность | Описание                                                                                                                                                                                                                                                                                                                 |
| -------------- | --------- | ------------------- | -------------- | --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Вагон          | 1 . . *   | имеет               | Тип места      | 0 . . *   | Места в вагоне. Вагон может не иметь мест для посадки пассажиров. Например, вагон-ресторан                                                                                                                                                                                                                               |
| Группа вагонов | 1 . . *   | состоит из          | Вагон          | 0 . . *   | Объединение вагонов в группу                                                                                                                                                                                                                                                                                             |
| Перевозчик     | 1 . . 1   | формирует           | Поезд          | 0 . . *   | Перевозчик планирует перечень поездов на будущий период или добавляет поезда в текущий период при необходимости                                                                                                                                                                                                          |
| Перевозчик     | 1 . . 1   | формирует           | Поезд          | 0 . . *   | Перевозчик планирует перечень групп вагонов                                                                                                                                                                                                                                                                              |
| Поезд          | 1 . . *   | входит в            | ГДП            | 1 . . 1   | При создании поезда обязательно указывается в график движения, в который он включается (период курсирования, например 2024-2026 год). В случае необходимости включения поезда в следующий период (2027-2030) создается новый поезд с таким же номером                                                                    |
| Поезд          | 1 . . 1   | имеет               | Схема          | 1 . . *   | Поезд под одним и тем же номером может курсировать с разной схемой (набором групп вагонов в своем составе) в зависимости от даты, сезона или дней недели                                                                                                                                                                 |
| Поезд          | 1 . . *   | проследует          | Станция        | 2 . . *   | Каждый поезд проследует как минимум 2 станции (отравление со станции формирования и прибытие на станцию назначения)                                                                                                                                                                                                      |
| Поезд          | 1 . . 1   | составляет пару с   | Поезд          | 0 . . 1   | Два поезда составляют пару поезд туда и поезд обратно. В отдельных случаях обратный поезд может отсутствовать                                                                                                                                                                                                            |
| Поезд          | 0 . . *   | меняет локомотив на | Станция        | 0 . . *   | Выполняется смена локомотива. Может применяться на границе участка обслуживания локомотива, при смене вида тяги, при смене рода тока.                                                                                                                                                                                    |
| Станция        | 1 . . *   | принадлежит         | Дорога         | 1 . . 1   | Принадлежность станции к конкретной железной дороге                                                                                                                                                                                                                                                                      |
| Схема          | 0 . . *   | состоит из          | Группа вагонов | 0 . . *   | Схема включает в себя различные группы вагонов. При создании поезда схема не имеет никаких групп. При создании группы они так же не привязаны ни к какой схеме. После согласования состава групп они включаются в схему поезда. Одна и та же группа может включатся в разные схемы одного поезда и схемы других поездов. |

## Логическая модель

### Диаграмма

![LMD](./img/LMD.drawio.svg)

### Домены

| Атрибут                  | Домен               | Описание                                                                     | Определение домена                                                                                    |
| ------------------------ | ------------------- | ---------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------- |
| Начало периода           | Дата                | Возможные значения даты                                                      | Дата; диапазон от 01.01.2023                                                                          |
| Окончание периода        | Дата                | Возможные значения даты                                                      | Дата; диапазон от 01.01.2024                                                                          |
| Номер                    | Пассажирские номера | Множество номеров пассажирских поездов на сети ЖД РФ                         | Строка; 5 знаков, ABCDE<br>A - всегда "0"<br>BCD - цифры 1-9<br>Е - буква, кириллица, верхний регистр |
| Категория                | Категории           | Множество категорий поездов по классификации РЖД                             | Строка; Максимальная длина 255 символов                                                               |
| Наименование             | Строка              | Произвольный текст                                                           | Строка; Максимальная длина 255 символов                                                               |
| Фирменность              | Признак             | Признак фирменного поезда                                                    | Логический; 1 - свойство есть, 0 - свойства нет                                                       |
| Сезонность               | Строка              | Множество вариантов сезонов курсирования поездов                             | Строка; Максимальная длина 50 символов                                                                |
| Статус                   | Статусы поездов     | Множество статусов поездов                                                   | Строка; Максимальная длина 50 символов                                                                |
| Сокращенное наименование | Строка              | Произвольный текст                                                           | Строка; Максимальная длина 20 символов                                                                |
| Номер                    | Число               | Множество целых чисел                                                        | Число; Целое число в диапазоне от 1 до 100                                                            |
| Периодичность            | Виды периодичности  | Множество вариантов периодичности курсирования поезда                        | Строка; Максимальная длина 50 символов                                                                 |
| Даты отправления         | Список дат          | Список содержащий даты, в которые отправляется поезд со станции формирования | Список; максимальное количество элементов 2000; диапазон дат от 01.01.2023                            |
| Даты прибытия            | Список дат          | Список содержащий даты, в которые отправляется поезд со станции назначения   | Список; максимальное количество элементов 2000; диапазон дат от 01.01.2023                            |
| Статус                   | Статусы групп       | Множество статусов групп вагонов                                             | Строка; Максимальная длина 50 символов                                                                 |
| Позиция                  | Признак             | Признак нумерации с головы состава                                           | Логический; 1 - с головы состава, 0 - с хвоста состава                                                |
| Примечание               | Строка              | Произвольный текст                                                           | Строка; Максимальное количество символов 1000                                                         |
| Количество вагонов       | Число               | Множество целых чисел                                                        | Число; Целое число в диапазоне от 1 до 30                                                             |
| Порядковый номер         | Число               | Множество целых чисел                                                        | Число; Целое число, минимальное значение 1                                                            |
| Признак группы           | Строка              | Множество признаков группы в поезде                                          | Строка; 1 символ                                                                                      |
| Расположение             | Признак             | Признаки прицепки с головы состава                                           | Логический; 1 - с головы состава, 0 - с хвоста состава                                                |
| Условный номер           | Число               | Множество целых чисел                                                        | Число; Целое число в диапазоне от 0 до 100                                                            |
| Тип                      | Типы вагонов        | Множество типов вагонов                                                      | Строка; Максимальная длина 50 символов                                                                |
| Депо приписки            | Вагонные депо       | Множество вагонных депо                                                      | Строка; Максимальная длина 255 символов                                                               |
| Габарит                  | Габариты вагонов    | Множество габаритов вагонов                                                  | Строка; Максимальная длина 20 символов                                                                |
| Тип тормоза              | Типы тормозов       | Множество типов тормозов                                                     | Строка; Максимальная длина 50 символов                                                                |
| Кондиционер              | Признак             | Признак наличия кондиционера                                                 | Логический; 1 - Кондиционер есть, 0 - кондиционера нет                                                |
| ЭЧТК                     | Признак             | Признак наличия экологически чистого туалетного комплекса                    | Логический; 1 - ЭЧТК есть, 0 - обычный туалет                                                         |
| Модель                   | Модели вагонов      | Множество моделей вагона                                                     | Строка; Максимальная длина 50 символов                                                                |
| Класс обслуживания       | Классы обслуживания | Множество классов обслуживания                                               | Строка; 2 символа: Цифра + буква кириллицы в верхнем регистре                                         |
| Количество мест          | Число               | Множество целых чисел                                                        | Число; Целое число в диапазоне от 0 до 100                                                            |
| Признак места            | Признаки мест       | Множество признаков мест                                                     | Строка; Максимальная длина 50 символов                                                                |
| Код ЕСР                  | Коды ЕСР            | Множество кодов единой сетевой разметки железных дорог                       | Строка; 6 знаков; Только цифры 0-9                                                                    |
| Код экспресс             | Коды экспресс       | Множество кодов системы Экспресс                                             | Строка; 7 знаков; Только цифры 0-9                                                                    |
| Посадка/высадка          | Признак             | Признаки посадки/посадки высадки пассажиров                                  | Логический; 1 - посадка/высадка есть; 0 - по посадки/высадки нет                                      |
| Смена рода тока          | Признак             | Признаки смены рода тока                                                     | Логический; 1 - смена рода тока есть; 0 - смены рода тока нет                                         |
| Смена вида тяги          | Признак             | Признаки смены вида тяги                                                     | Логический; 1 - смена вида тяги есть; 0 - смены вида тяги нет                                         |
| Смена локомотива         | Признак             | Признаки смены локомотива                                                    | Логический; 1 - смена локомотива есть; 0 - смены локомотива нет                                       |
| Смена бригады            | Признак             | Признаки смены бригады                                                       | Логический; 1 - смена бригады есть; 0 - смены бригады нет                                             |
| Заправка водой           | Признак             | Признаки заправки водой                                                      | Логический; 1 - выполняется заправка водой; 0 - не выполняется заправка водой                         |
| Заправка топливом        | Признак             | Признаки заправки топливом                                                   | Логический; 1 - выполняется заправка топливом; 0 - не выполняется заправка топливом                   |
| Очистка туалета          | Признак             | Признаки очистки туалета                                                    | Логический; 1 - выполняется очистка туалета; 0 - не выполняется очистка туалета                       |
| Таможенный контроль      | Признак             | Признаки таможенного контроля                                                | Логический; 1 - выполняется таможенный контроль; 0 - не выполняется таможенный контроль               |
| Код                      | Коды дорог          | Множество кодов дорог                                                        | Строка; 3 символа, только цифры 1-9                                                                   |

## Полноатрибутная модель

### Диаграмма

![FLMD](./img/FLMD.drawio.svg)

### Описание таблиц

Приведено описание части таблиц, чтобы дать представление о структуре табличного описания сущностей, не перегружая пример деталями.

#### ГДП

График движения поездов

| №   | Атрибут           | Домен | О/Н | Описание                                                                                                            |
| --- | ----------------- | ----- | --- | ------------------------------------------------------------------------------------------------------------------- |
| 1   | ID                | Целое | О   | Идентификатор записи.<br>Первичный ключ.<br>Формат: Целое положительное                                             |
| 2   | Начало периода    | Дата  | О   | Дата начала периода действия графика движения поездов.<br>Формат: dd-mm-yyyy<br>Минимальное значение: 01.01.2023    |
| 3   | Окончание периода | Дата  | О   | Дата окончания периода действия графика движения поездов.<br>Формат: dd-mm-yyyy<br>Минимальное значение: 01.01.2024 |

#### Поезд

| №   | Атрибут        | Домен   | О/Н | Описание                                                                                                                                                                                    |
| --- | -------------- | ------- | --- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1   | ID             | Целое   | О   | Идентификатор записи.<br>Первичный ключ.<br>Формат: Целое положительное                                                                                                                     |
| 2   | ГДП            | Целое   | О   | Внешний ключ на ГДП.                                                                                                                                                                        |
| 3   | Перевозчик     | Целое   | О   | Внешний ключ на перевозчика                                                                                                                                                                 |
| 4   | Номер          | Строка  | О   | Номер пассажирского поезда на сети РЖД.<br>Формат: ABCDE, где А - 0, BCD - цифры 1-9, E - буква кириллицы в верхнем регистре<br>Минимальное значение: 0001А<br>максимальное значение: 0998Я |
| 5   | Категория      | Целое   | О   | Внешний ключ на категорию поездов                                                                                                                                                           |
| 6   | Наименование   | Строка  | Н   | Индивидуальное наименование поезда.<br>Максимальная длина: 255 символов                                                                                                                     |
| 7   | Фирменность    | Признак | О   | Логический признак фирменности поезда.<br>True - фирменный;<br>False - не фирменный                                                                                                         |
| 8   | Сезонность     | Целое   | О   | Внешний ключ на сезонность                                                                                                                                                                  |
| 9   | Статус         | Строка  | О   | Статус поезда в маршрутной сети<br>Максимальная длина: 255 символов                                                                                                                         |
| 10  | Обратный поезд | Целое   | О   | Внешний ключ на поезд                                                                                                                                                                       |

#### Станция в маршруте

| №   | Атрибут           | Домен | О/Н | Описание                                                                                                                                                 |
| --- | ----------------- | ----- | --- | -------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1   | ID                | Целое | О   | Идентификатор записи.<br>Первичный ключ.<br>Формат: Целое положительное                                                                                  |
| 2   | Поезд             | Целое | О   | Внешний ключ на поезд                                                                                                                                    |
| 3   | Станция           | Целое | О   | Внешний ключ на станцию                                                                                                                                  |
| 4   | Время прибытия    | Время | Н   | Время прибытия поезда на станцию.<br>Не заполняется для станции формирования.<br>Формат: hh:mm:ss                                                        |
| 5   | Сутки прибытия    | Число | Н   | Сутки прибытия поезда на станцию с момента отправления со станции формирования.<br>Формат: Целое<br>Минимальное значение: 0<br>Максимальное значение: 10 |
| 6   | Время отправления | Время | Н   | Время отправления поезда на станцию.<br>Не заполняется для станции назначения.<br>Формат: hh:mm:ss                                                       |
| 7   | Сутки отправления | Число | Н   | Сутки отправления поезда со станции с момента отправления со станции формирования.                                                                       |
| 8   | Расстояние        | Число | О   | Расстояние от станции формирования в километрах.<br>Формат: Целое<br>Минимальное значение: 0                                                             |

**Дополнительные требования:** 
- При удалении *поезда* должны удаляться все *станции в маршруте* по поезду.
- При удалении *станции* должны удаляться соответствующие *станции смены локомотива* во всех поездах.

#### Станция смены локомотива

| №   | Атрибут    | Домен  | О/Н | Описание                                                                         |
| --- | ---------- | ------ | --- | -------------------------------------------------------------------------------- |
| 1   | ID         | Целое  | О   | Идентификатор записи.<br>Первичный ключ.<br>Формат: Целое положительное          |
| 2   | Поезд      | Целое  | О   | Внешний ключ на поезд                                                            |
| 3   | Станция    | Целое  | О   | Внешний ключ на станцию                                                          |
| 4   | Примечание | Строка | Н   | Дополнительные сведения в произвольной форме.<br>Максимальная длина 500 символов |

**Дополнительные требования:** 
- При удалении *поезда* должны удаляться все *станции смены локомотива* по поезду.

#### Схема

| №   | Атрибут          | Домен      | О/Н | Описание                                                                                                                                                                                                     |
| --- | ---------------- | ---------- | --- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 1   | ID               | Целое      | О   | Идентификатор записи.<br>Первичный ключ.<br>Формат: Целое положительное                                                                                                                                      |
| 2   | Поезд            | Целое      | О   | Внешний ключ на поезд                                                                                                                                                                                        |
| 3   | Номер            | Число      | О   | Номер схемы в поезде<br>Минимальное значение: 1<br>Максимальное значение: 10                                                                                                                                 |
| 4   | Периодичность    | Целое      | О   | Внешний ключ на вид периодичности                                                                                                                                                                            |
| 5   | Даты отправления | Список дат | О   | Список дат, в которые выполняется отправление поезда со станции формирования.<br>Формат: массив с элементом в формате дата<br>Минимальное количество элементов: 0<br>Максимальное количество элементов: 2000 |
| 6   | Даты прибытия    | Список дат | О   | Список дат, в которые прибывает поезд на станцию назначения.<br>Формат: массив с элементом в формате дата<br>Минимальное количество элементов: 0<br>Максимальное количество элементов: 2000                  |

**Дополнительные требования:** 
- При удалении *поезда* должны удаляться все *схемы* по поезду.

#### Способ нумерации вагонов

| №   | Атрибут           | Домен   | О/Н | Описание                                                                                    |
| --- | ----------------- | ------- | --- | ------------------------------------------------------------------------------------------- |
| 1   | ID                | Целое   | О   | Идентификатор записи.<br>Первичный ключ.<br>Формат: Целое положительное                     |
| 2   | Схема             | Целое   | О   | Внешний ключ на схему                                                                       |
| 3   | Позиция           | Признак | О   | Логический признак фирменности поезда.<br>- True - голова;<br>- False - хвост               |
| 4   | Станция начала    | Целое   | О   | Станция начала участка применения способа нумерации вагонов.<br>Внешний ключ на станцию.    |
| 5   | Станция окончания | Целое   | О   | Станция окончания участка применения способа нумерации вагонов.<br>Внешний ключ на станцию. |
| 6   | Примечание        | Строка  | Н   | Дополнительные сведения в произвольной форме.<br>Максимальная длина 500 символов            |

**Дополнительные требования:** 
- При удалении *схемы* должны удаляться все *способы нумерации* по схеме.

#### Допустимая длина поезда

| №   | Атрибут            | Домен  | О/Н | Описание                                                                                             |
| --- | ------------------ | ------ | --- | ---------------------------------------------------------------------------------------------------- |
| 1   | ID                 | Целое  | О   | Идентификатор записи.<br>Первичный ключ.<br>Формат: Целое положительное                              |
| 2   | Схема              | Целое  | О   | Внешний ключ на схему                                                                                |
| 3   | Количество вагонов | Число  | О   | Количество вагонов в поезде<br>Формат: Целое<br>Минимальное значение: 3<br>Максимальное значение: 25 |
| 4   | Станция начала     | Целое  | О   | Станция начала участка применения ограничения по длине поезда.<br>Внешний ключ на станцию.<br>       |
| 5   | Станция конца      | Целое  | О   | Станция конца участка применения ограничения по длине поезда.<br>Внешний ключ на станцию.            |
| 6   | Примечание         | Строка | Н   | Дополнительные сведения в произвольной форме.<br>Максимальная длина 500 символов                     |

**Дополнительные требования:** 
- При удалении *схемы* должны удаляться все *записи по допустимой длине* по схеме.

#### Группа в схеме

| №   | Атрибут          | Домен   | О/Н | Описание                                                                                                                        |
| --- | ---------------- | ------- | --- | ------------------------------------------------------------------------------------------------------------------------------- |
| 1   | ID               | Целое   | О   | Идентификатор записи.<br>Первичный ключ.<br>Формат: Целое положительное                                                         |
| 2   | Схема            | Целое   | О   | Внешний ключ на схему                                                                                                           |
| 3   | Группа           | Целое   | О   | Внешний ключ на группу вагонов                                                                                                  |
| 4   | Порядковый номер | Число   | О   | Номер группы по порядку следования в схеме<br>Формат: Целое<br>Минимальное значение: 1                                          |
| 5   | Признак группы   | Целое   | О   | Внешний ключ на признак группы                                                                                                  |
| 6   | Расположение     | Признак | Н   | Логический признак расположения группы<br>- True - голова<br>- False - хвост<br>Для групп с признаком "Основная" не заполняется |

**Дополнительные требования:** 
- При удалении *схемы* должны удаляться все *группы в схеме* по схеме.
- При удалении *группы вагонов* должны удаляться соответствующие *группы в схеме*.

#### Группа вагонов

| №   | Атрибут      | Домен  | О/Н | Описание                                                                |
| --- | ------------ | ------ | --- | ----------------------------------------------------------------------- |
| 1   | ID           | Целое  | О   | Идентификатор записи.<br>Первичный ключ.<br>Формат: Целое положительное |
| 2   | Перевозчик   | Целое  | О   | Внешний ключ на перевозчика                                             |
| 3   | Наименование | Строка | О   | Наименование группы вагонов<br>Максимальная длина 255 символов          |
| 4   | Статус       | Строка | О   | Статус группы вагонов<br>Максимальная длина 255 символов                |
#### Вагон

| №   | Атрибут          | Домен   | О/Н | Описание                                                                                                             |
| --- | ---------------- | ------- | --- | -------------------------------------------------------------------------------------------------------------------- |
| 1   | ID               | Целое   | О   | Идентификатор записи.<br>Первичный ключ.<br>Формат: Целое положительное                                              |
| 2   | Группа вагонов   | Целое   | О   | Внешний ключ на группу вагонов                                                                                       |
| 3   | Условный номер   | Число   | О   | Условный номер вагона в поезде<br>Формат: Целое<br>Минимальное значение: 1<br>Максимальное значение: 100             |
| 4   | Порядковый номер | Число   | О   | Номер вагона по порядку в составе.<br>Формат: Целое<br>Минимальное значение: 1<br>Максимальное значение: 25          |
| 5   | Тип              | Целое   | О   | Внешний ключ на тип вагона                                                                                           |
| 6   | Депо приписки    | Целое   | О   | Внешний ключ на депо приписки                                                                                        |
| 7   | Габарит          | Целое   | О   | Внешний ключ на габарит вагона                                                                                       |
| 8   | Тип тормоза      | Целое   | О   | Внешний ключ на тип тормоза                                                                                          |
| 9   | Кондиционер      | Признак | О   | Логический признак наличия кондиционера в вагоне.<br>- True - кондиционер есть;<br>- False - кондиционер отсутствует |
| 10  | ЭЧТК             | Признак | О   | Логический признак наличия ЭЧТК (биотуалет)<br>- True - ЭЧТК;<br>- False - обычный туалет                            |
| 11  | Модель           | Целое   | О   | Внешний ключ на модель вагона                                                                                        |

**Дополнительные требования:** 
- При удалении *группы вагонов* должны удаляться все *вагоны* группы.

#### Тип места

| №   | Атрибут            | Домен | О/Н | Описание                                                                                       |
| --- | ------------------ | ----- | --- | ---------------------------------------------------------------------------------------------- |
| 1   | ID                 | Целое | О   | Идентификатор записи.<br>Первичный ключ.<br>Формат: Целое положительное                        |
| 2   | Вагон              | Целое | О   | Внешний ключ на вагон                                                                          |
| 3   | Класс обслуживания | Целое | О   | Внешний ключ на класс обслуживания                                                             |
| 4   | Количество мест    | Число | О   | Количество мест определенного класса обслуживания.<br>Формат: Целое<br>Минимальное значение: 1 |
| 5   | Признак места      | Целое | О   | Внешний ключ на признак места                                                                  |

#### Станции

| №   | Атрибут             | Домен   | О/Н | Описание                                                                                                                             |
| --- | ------------------- | ------- | --- | ------------------------------------------------------------------------------------------------------------------------------------ |
| 1   | ID                  | Целое   | О   | Идентификатор записи.<br>Первичный ключ.<br>Формат: Целое положительное                                                              |
| 2   | Дорога              | Целое   | О   | Внешний ключ на дрогу                                                                                                                |
| 3   | Наименование        | Строка  | О   | Наименование станции.<br>Максимальная длина 255 символов                                                                             |
| 4   | Код ЕСР             | Строка  | N   | Код единой сетевой разметки железных дорог.<br>Формат: Цифры 0-9<br>Минимальная длина: 6<br>Максимальная длина 6                     |
| 5   | Код экспресс        | Строка  | О   | Код станции в системе Экспресс<br>Формат: Цифры 0-9<br>Минимальная длина: 7<br>Максимальная длина: 7                                 |
| 6   | Посадка/высадка     | Признак | О   | Логический признак осуществления посадки и высадки пассажиров на станции.<br>- True - осуществляется;<br>- False - не осуществляется |
| 7   | Смена рода тока     | Признак | О   | Логический признак смены рода тока по станции.<br>- True - осуществляется;<br>- False - не осуществляется                            |
| 8   | Смена вида тяги     | Признак | О   | Логический признак смены вида тяги по станции.<br>- True - осуществляется;<br>- False - не осуществляется                            |
| 9   | Смена локомотива    | Признак | О   | Логический признак смены локомотива по станции.<br>- True - осуществляется;<br>- False - не осуществляется                           |
| 10  | Смена бригады       | Признак | О   | Логический признак смены бригады на станции.<br>- True - осуществляется;<br>- False - не осуществляется                             |
| 11  | Заправка водой      | Признак | О   | Логический признак заправки водой на станции.<br>- True - осуществляется;<br>- False - не осуществляется                             |
| 12  | Заправка топливом   | Признак | О   | Логический признак заправки локомотива топливом.<br>- True - осуществляется;<br>- False - не осуществляется                          |
| 13  | Очистка туалета     | Признак | О   | Логический признак очистки туалета.<br>- True - осуществляется;<br>- False - не осуществляется                                       |
| 14  | Таможенный контроль | Признак | О   | Логический признак таможенного контроля.<br>- True - осуществляется;<br>- False - не осуществляется                                  |

#### Дорога

| №   | Атрибут      | Домен  | О/Н | Описание                                                                          |
| --- | ------------ | ------ | --- | --------------------------------------------------------------------------------- |
| 1   | ID           | Целое  | О   | Идентификатор записи.<br>Первичный ключ.<br>Формат: Целое положительное           |
| 2   | Наименование | Строка | О   | Наименование железной дороги.<br>Максимальная длина: 255                          |
| 3   | Код          | Строка | О   | Код дороги.<br>Формат: Цифры 0-9<br>Минимальная длина: 3<br>Максимальная длина: 3 |
#### Перевозчик

| №   | Атрибут                  | Домен  | О/Н | Описание                                                                |
| --- | ------------------------ | ------ | --- | ----------------------------------------------------------------------- |
| 1   | ID                       | Целое  | О   | Идентификатор записи.<br>Первичный ключ.<br>Формат: Целое положительное |
| 2   | Наименование             | Строка | О   | Наименование перевозчика.<br>Максимальная длина: 255                    |
| 3   | Сокращенное наименование | Строка | О   | Сокращенное наименование перевозчика<br>Максимальная длина: 30          |
#### Категория поезда

| №   | Атрибут          | Домен  | О/Н | Описание                                                                                                                          |
| --- | ---------------- | ------ | --- | --------------------------------------------------------------------------------------------------------------------------------- |
| 1   | ID               | Целое  | О   | Идентификатор записи.<br>Первичный ключ.<br>Формат: Целое положительное                                                           |
| 2   | Наименование     | Строка | О   | Наименование категории поезда.<br>Максимальная длина: 255                                                                         |
| 3   | Описание         | Строка | О   | Описание категории поезда.<br>Максимальная длина: 1000                                                                            |
| 4   | Начало диапазона | Число  | О   | Левая граница диапазона номеров поездов для категории.<br>Формат: Целое<br>Минимальное значение: 1<br>Максимальное значение: 998  |
| 5   | Конец диапазона  | Число  | О   | Правая граница диапазона номеров поездов для категории.<br>Формат: Целое<br>Минимальное значение: 1<br>Максимальное значение: 998 |

## Физическая модель

### Диаграмма

![PMD](./img/PMD.drawio.svg)

### Описание таблиц (DDL)

Приведено описание части таблиц.

```sql
-- График движения поездов
CREATE TABLE gdps (
	id serial4 PRIMARY KEY,
	start_at date NOT NULL,
	end_at date NOT NULL
);

-- Перевозчики
CREATE TABLE carriers (
	id serial4 PRIMARY KEY,
	name text NOT NULL,
	short_name text NOT NULL,
	CONSTRAINT carrier_short_name_unique UNIQUE (short_name)
);

-- Категории поездов
CREATE TABLE categories (
	id serial4 PRIMARY KEY,
	name text NOT NULL,
	description text NOT NULL,
	lower_bound int2 NOT NULL,
	upper_bound int2 NOT NULL,
	CONSTRAINT category_name_unique UNIQUE (name)
);

-- Сезонность
CREATE TABLE seasons (
	id serial4 PRIMARY KEY,
	name text NOT NULL,
	CONSTRAINT season_name_unique UNIQUE (name)
);

-- Дороги
CREATE TABLE railways (
	id serial4 PRIMARY KEY,
	name text NOT NULL,
	code char(3) NOT NULL,
	CONSTRAINT railway_code_unique UNIQUE (code)
);

-- Станции
CREATE TABLE stations (
	id serial4 PRIMARY KEY,
	railway_id int4 NOT NULL REFERENCES railways(id),
	name text NOT NULL,
	ESR_code char(6) NOT NULL,
	express_code char(7) NOT NULL,
	is_boarding	 bool NOT NULL DEFAULT FALSE,
	is_change_electricity_type	bool NOT NULL DEFAULT FALSE,
	is_change_traction_type bool NOT NULL DEFAULT FALSE,
	is_change_locomotive bool NOT NULL DEFAULT FALSE,
	is_change_locomotive_team bool NOT	NULL DEFAULT FALSE,
	is_water_supply bool NOT NULL DEFAULT FALSE,
	is_fuel_supply bool NOT NULL DEFAULT FALSE,
	is_eco_toilet bool NOT NULL DEFAULT FALSE,
	is_border_control bool NOT NULL DEFAULT FALSE,
	CONSTRAINT station_express_unique UNIQUE (express_code)
);

-- Периодичность
CREATE TABLE periodicity (
	id serial4 PRIMARY KEY,
	name text NOT NULL,
	CONSTRAINT periodicity_name_unique UNIQUE (name)
);

-- Поезда
CREATE TABLE trains (
	id serial4 PRIMARY KEY,
	gdp_id int4 NOT NULL REFERENCES gdps(id),
	carries_id int4 NOT NULL REFERENCES carriers(id),
	number char(5) NOT NULL,
	category_id int4 NOT NULL REFERENCES categories(id),
	name text NULL,
	is_brand bool NOT NULL,
	season_id int4 NOT NULL REFERENCES seasons(id),
	status text NOT NULL,
	train_id int4 NULL REFERENCES trains(id)
);

-- Маршруты
CREATE TABLE routes (
	id serial4 PRIMARY KEY,
	train_id int4 NOT NULL REFERENCES trains(id),
	station_id int4 NOT NULL REFERENCES stations(id),
	arrival_at time NULL,
	arrival_day int2 NULL,
	departure_at time NULL,
	departure_day int2 NULL,
	distance int2 NOT NULL
);

CREATE INDEX routes_train_idx ON routes USING btree (train_id);
CREATE INDEX routes_station_idx ON routes USING btree (station_id);

-- Станции смены локомотивов
CREATE TABLE locomotive_changing_stations (
	id serial4 PRIMARY KEY,
	train_id int4 NOT NULL REFERENCES trains(id),
	station_id int4 NOT NULL REFERENCES stations(id),
	note text NULL
);

CREATE INDEX locomotive_changing_train_idx ON locomotive_changing_stations USING btree (train_id);
CREATE INDEX locomotive_changing_station_idx ON locomotive_changing_stations USING btree (station_id);

-- Схемы 
CREATE TABLE schemas (
	id serial4 PRIMARY KEY,
	train_id int4 NOT NULL REFERENCES trains(id),
	number int2 NOT NULL,
	periodicity_id int4 NOT NULL REFERENCES periodicity(id),
	departure_at date NOT NULL,
	arrival_at date NOT NULL
);
```